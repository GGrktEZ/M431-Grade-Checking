@page "/auth-callback"
@inject NavigationManager Nav
@inject Frontend.AuthState AuthState

<h3>Login wird abgeschlossen...</h3>

@code {
    protected override void OnInitialized()
    {
        var uri = Nav.ToAbsoluteUri(Nav.Uri);

        var query = uri.Query.TrimStart('?')
            .Split('&', StringSplitOptions.RemoveEmptyEntries);

        string? token = null;
        string? teacherIdStr = null;

        foreach (var part in query)
        {
            var kv = part.Split('=', 2);
            if (kv.Length != 2) continue;

            var key = Uri.UnescapeDataString(kv[0]);
            var value = Uri.UnescapeDataString(kv[1]);

            if (key == "token") token = value;
            if (key == "teacherId") teacherIdStr = value;
        }

        if (!string.IsNullOrWhiteSpace(token))
            AuthState.Token = token;

        if (int.TryParse(teacherIdStr, out var tid))
            AuthState.TeacherId = tid;

        // ❗ KEIN Reload in Blazor WASM
        Nav.NavigateTo("/formular");
    }
}
